(()=>{"use strict";var e={38:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AIServiceFactory=void 0;const s=n(346);class a{static getInstance(){return this.instance||(this.instance=new s.PromptAPIService),this.instance}static createNew(){return new s.PromptAPIService}static cleanup(){this.instance&&(this.instance.destroy(),this.instance=null)}static async isAvailable(){return s.PromptAPIService.checkAvailability()}}t.AIServiceFactory=a,a.instance=null},107:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPanel=void 0;const s=n(139),a=n(560),i=n(628),o=n(167),r=n(38);t.ChatPanel=class{constructor(){this.element=null,this.shadowRoot=null,this.chatHistory=[],this.isVisible=!1,this.viewModeContext=null,this.createElement(),this.loadChatHistory()}createElement(){this.element=document.createElement("div"),this.element.id=s.Constants.IDS.CHAT_PANEL,this.element.style.cssText=`\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            width: ${s.Constants.UI_DIMENSIONS.CHAT_PANEL.WIDTH}px;\n            height: ${s.Constants.UI_DIMENSIONS.CHAT_PANEL.HEIGHT}px;\n            z-index: ${s.Constants.Z_INDEX.CHAT_PANEL};\n            display: none;\n            pointer-events: auto;\n        `,this.shadowRoot=this.element.attachShadow({mode:"open"}),a.ThemeManager.injectThemeCSS(this.shadowRoot),a.ThemeManager.watchThemeChanges(this.shadowRoot),this.shadowRoot.innerHTML='\n            <div class="chat-panel netherite-glass netherite-animate-slide-up">\n                <div class="chat-header">\n                    <div class="header-content">\n                        <h2>💬 Netherite Assistant</h2>\n                        <div class="header-actions">\n                            <button id="newChatBtn" class="header-btn" title="Start New Chat">\n                                🔄\n                            </button>\n                            <button id="closeBtn" class="header-btn close" title="Close Chat">\n                                ×\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="chat-messages" id="chatMessages">\n                    <div class="welcome-message">\n                        <p>👋 Welcome to Netherite AI Assistant!</p>\n                        <p>I can help you analyze this page and fill forms intelligently.</p>\n                        <p>Type your message or use <strong>@doc</strong> to reference your uploaded document.</p>\n                    </div>\n                </div>\n\n                <div class="chat-input-area">\n                    <div class="input-container">\n                        <textarea id="chatInput" placeholder="Ask me anything about this page or type @doc to reference your document..."></textarea>\n                        <button id="sendBtn" class="send-btn" title="Send Message">\n                            <span class="send-icon">➤</span>\n                        </button>\n                    </div>\n                    <div class="input-footer">\n                        <div class="document-status" id="documentStatus"></div>\n                        <div class="typing-indicator" id="typingIndicator" style="display: none;">\n                            <span class="dot"></span>\n                            <span class="dot"></span>\n                            <span class="dot"></span>\n                            AI is thinking...\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <style>\n                .chat-panel {\n                    width: 100%;\n                    height: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    overflow: hidden;\n                }\n\n                .chat-header {\n                    padding: 20px 24px 16px;\n                    border-bottom: 1px solid var(--netherite-border);\n                    flex-shrink: 0;\n                }\n\n                .header-content {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                }\n\n                .header-content h2 {\n                    margin: 0;\n                    font-size: 18px;\n                    font-weight: 600;\n                    color: var(--netherite-text-primary);\n                }\n\n                .header-actions {\n                    display: flex;\n                    gap: 8px;\n                }\n\n                .header-btn {\n                    width: 32px;\n                    height: 32px;\n                    border: none;\n                    border-radius: 50%;\n                    background: var(--netherite-hover-bg);\n                    color: var(--netherite-text-secondary);\n                    font-size: 16px;\n                    cursor: pointer;\n                    transition: all 0.2s ease;\n                }\n\n                .header-btn:hover {\n                    background: var(--netherite-active-bg);\n                    color: var(--netherite-text-primary);\n                    transform: scale(1.05);\n                }\n\n                .chat-messages {\n                    flex: 1;\n                    overflow-y: auto;\n                    padding: 16px 24px;\n                    display: flex;\n                    flex-direction: column;\n                    gap: 16px;\n                }\n\n                .welcome-message {\n                    text-align: center;\n                    color: var(--netherite-text-secondary);\n                    padding: 20px;\n                    background: var(--netherite-bg-secondary);\n                    border-radius: 12px;\n                    font-size: 14px;\n                    line-height: 1.5;\n                }\n\n                .welcome-message p {\n                    margin: 8px 0;\n                }\n\n                .message {\n                    max-width: 80%;\n                    padding: 12px 16px;\n                    border-radius: 16px;\n                    font-size: 14px;\n                    line-height: 1.5;\n                    word-wrap: break-word;\n                }\n\n                .message.user {\n                    align-self: flex-end;\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    color: white;\n                    border-bottom-right-radius: 6px;\n                }\n\n                .message.assistant {\n                    align-self: flex-start;\n                    background: var(--netherite-glass-bg);\n                    border: 1px solid var(--netherite-glass-border);\n                    color: var(--netherite-text-primary);\n                    border-bottom-left-radius: 6px;\n                }\n\n                .message .timestamp {\n                    font-size: 11px;\n                    opacity: 0.7;\n                    margin-top: 4px;\n                }\n\n                .chat-input-area {\n                    padding: 16px 24px 20px;\n                    border-top: 1px solid var(--netherite-border);\n                    flex-shrink: 0;\n                }\n\n                .input-container {\n                    display: flex;\n                    gap: 8px;\n                    align-items: flex-end;\n                }\n\n                #chatInput {\n                    flex: 1;\n                    min-height: 40px;\n                    max-height: 120px;\n                    padding: 12px 16px;\n                    border: 1px solid var(--netherite-border);\n                    border-radius: 20px;\n                    background: var(--netherite-bg-secondary);\n                    color: var(--netherite-text-primary);\n                    font-family: inherit;\n                    font-size: 14px;\n                    resize: none;\n                    outline: none;\n                    transition: all 0.2s ease;\n                }\n\n                #chatInput:focus {\n                    border-color: var(--netherite-text-accent);\n                    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);\n                }\n\n                .send-btn {\n                    width: 40px;\n                    height: 40px;\n                    border: none;\n                    border-radius: 50%;\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    color: white;\n                    cursor: pointer;\n                    transition: all 0.2s ease;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n\n                .send-btn:hover {\n                    transform: scale(1.05);\n                    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n                }\n\n                .send-btn:disabled {\n                    opacity: 0.5;\n                    cursor: not-allowed;\n                    transform: none;\n                }\n\n                .input-footer {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-top: 8px;\n                    min-height: 20px;\n                }\n\n                .document-status {\n                    font-size: 12px;\n                    color: var(--netherite-text-secondary);\n                }\n\n                .document-chip {\n                    display: inline-flex;\n                    align-items: center;\n                    background: var(--netherite-text-accent);\n                    color: white;\n                    padding: 4px 8px;\n                    border-radius: 12px;\n                    font-size: 11px;\n                    gap: 4px;\n                }\n\n                .typing-indicator {\n                    display: flex;\n                    align-items: center;\n                    gap: 4px;\n                    color: var(--netherite-text-secondary);\n                    font-size: 12px;\n                }\n\n                .typing-indicator .dot {\n                    width: 4px;\n                    height: 4px;\n                    border-radius: 50%;\n                    background: var(--netherite-text-accent);\n                    animation: typing-pulse 1.4s infinite ease-in-out;\n                }\n\n                .typing-indicator .dot:nth-child(2) {\n                    animation-delay: 0.2s;\n                }\n\n                .typing-indicator .dot:nth-child(3) {\n                    animation-delay: 0.4s;\n                }\n\n                @keyframes typing-pulse {\n                    0%, 60%, 100% {\n                        opacity: 0.3;\n                        transform: scale(0.8);\n                    }\n                    30% {\n                        opacity: 1;\n                        transform: scale(1);\n                    }\n                }\n\n                /* Scrollbar styling */\n                .chat-messages::-webkit-scrollbar {\n                    width: 6px;\n                }\n\n                .chat-messages::-webkit-scrollbar-track {\n                    background: var(--netherite-bg-secondary);\n                    border-radius: 3px;\n                }\n\n                .chat-messages::-webkit-scrollbar-thumb {\n                    background: var(--netherite-text-secondary);\n                    border-radius: 3px;\n                }\n\n                .chat-messages::-webkit-scrollbar-thumb:hover {\n                    background: var(--netherite-text-primary);\n                }\n            </style>\n        ',this.setupEventListeners(),document.body.appendChild(this.element),i.Logger.ui("Chat panel created","ChatPanel")}setupEventListeners(){if(!this.shadowRoot)return;const e=this.shadowRoot.getElementById("chatInput"),t=this.shadowRoot.getElementById("sendBtn"),n=this.shadowRoot.getElementById("closeBtn"),s=this.shadowRoot.getElementById("newChatBtn");t?.addEventListener("click",()=>{this.handleSendMessage()}),e?.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.handleSendMessage())}),n?.addEventListener("click",()=>{this.hide()}),s?.addEventListener("click",()=>{this.startNewChat()}),e?.addEventListener("input",()=>{this.autoResizeTextarea(e)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isVisible&&this.hide()})}async handleSendMessage(){const e=this.shadowRoot?.getElementById("chatInput"),t=e?.value.trim();if(t)try{e.value="",this.setSendButtonState(!1),this.addMessage("user",t),this.showTypingIndicator(!0);const n=await this.processDocumentReference(t),s=r.AIServiceFactory.getInstance(),a=await s.generateChatResponse(n,this.chatHistory.slice(-10),{purpose:this.viewModeContext?.pageInfo?.title,fields:this.viewModeContext?.formFields?this.viewModeContext.formFields.map(e=>e.label).join(", "):void 0});this.addMessage("assistant",a)}catch(e){i.Logger.error("Error generating chat response:",e),this.addMessage("assistant","❌ Sorry, I encountered an error. Please try again.")}finally{this.setSendButtonState(!0),this.showTypingIndicator(!1),this.saveChatHistory()}}async processDocumentReference(e){if(!e.includes("@doc"))return e;const t=await o.StorageManager.getCurrentDocument();if(!t)return this.updateDocumentStatus("No document uploaded. Please upload a document first."),e.replace(/@doc/g,"[No document available]");const n=`\n[Document: ${t.name}]\n${t.content}\n[End of Document]\n        `;return this.updateDocumentStatus(`📄 Referencing: ${t.name}`),e.replace(/@doc/g,n)}addMessage(e,t){const n=this.shadowRoot?.getElementById("chatMessages");if(!n)return;const s=n.querySelector(".welcome-message");s&&0===this.chatHistory.length&&s.remove();const a=document.createElement("div");a.className=`message ${e}`;const o=(new Date).toLocaleTimeString();a.innerHTML=`\n            <div class="content">${this.formatMessageContent(t)}</div>\n            <div class="timestamp">${o}</div>\n        `,n.appendChild(a);const r={role:e,content:t,timestamp:Date.now()};this.chatHistory.push(r),this.scrollToBottom(),i.Logger.ui(`Message added: ${e}`,"ChatPanel")}formatMessageContent(e){return e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>")}autoResizeTextarea(e){e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}setSendButtonState(e){const t=this.shadowRoot?.getElementById("sendBtn");t&&(t.disabled=!e)}showTypingIndicator(e){const t=this.shadowRoot?.getElementById("typingIndicator");t&&(t.style.display=e?"flex":"none")}updateDocumentStatus(e){const t=this.shadowRoot?.getElementById("documentStatus");t&&(t.innerHTML=e)}scrollToBottom(){const e=this.shadowRoot?.getElementById("chatMessages");e&&(e.scrollTop=e.scrollHeight)}startNewChat(){this.chatHistory=[];const e=this.shadowRoot?.getElementById("chatMessages");e&&(e.innerHTML='\n                <div class="welcome-message">\n                    <p>👋 Welcome to Netherite AI Assistant!</p>\n                    <p>I can help you analyze this page and fill forms intelligently.</p>\n                    <p>Type your message or use <strong>@doc</strong> to reference your uploaded document.</p>\n                </div>\n            '),this.updateDocumentStatus(""),i.Logger.ui("New chat started","ChatPanel")}setViewModeContext(e){this.viewModeContext=e,i.Logger.debug("View mode context set",e)}async loadChatHistory(){try{if(this.chatHistory=await o.StorageManager.getChatHistory(),this.chatHistory.length>0){const e=this.shadowRoot?.getElementById("chatMessages");e&&(e.innerHTML="",this.chatHistory.forEach(e=>{this.addMessageToUI(e)}))}}catch(e){i.Logger.error("Failed to load chat history:",e)}}addMessageToUI(e){const t=this.shadowRoot?.getElementById("chatMessages");if(!t)return;const n=document.createElement("div");n.className=`message ${e.role}`;const s=new Date(e.timestamp).toLocaleTimeString();n.innerHTML=`\n            <div class="content">${this.formatMessageContent(e.content)}</div>\n            <div class="timestamp">${s}</div>\n        `,t.appendChild(n)}async saveChatHistory(){try{await o.StorageManager.saveChatHistory(this.chatHistory)}catch(e){i.Logger.error("Failed to save chat history:",e)}}show(){this.element&&!this.isVisible&&(this.element.style.display="block",this.isVisible=!0,setTimeout(()=>{const e=this.shadowRoot?.getElementById("chatInput");e?.focus()},100),i.Logger.ui("Chat panel shown","ChatPanel"))}hide(){if(!this.element||!this.isVisible)return;this.element.style.display="none",this.isVisible=!1;const e=new CustomEvent("netherite:chat-close");document.dispatchEvent(e),i.Logger.ui("Chat panel hidden","ChatPanel")}isOpen(){return this.isVisible}destroy(){this.element&&(a.ThemeManager.removeObserver(this.shadowRoot),document.body.removeChild(this.element),this.element=null,this.shadowRoot=null),i.Logger.ui("Chat panel destroyed","ChatPanel")}}},122:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FloatingToolbar=void 0;const s=n(139),a=n(560),i=n(167),o=n(628);t.FloatingToolbar=class{constructor(){this.element=null,this.shadowRoot=null,this.isDragging=!1,this.dragOffset={x:0,y:0},this.isVisible=!1,this.createElement(),this.setupEventListeners(),this.loadSavedPosition()}createElement(){this.element=document.createElement("div"),this.element.id=s.Constants.IDS.FLOATING_TOOLBAR,this.element.style.cssText=`\n            position: fixed;\n            top: 80px;\n            left: 50%;\n            transform: translateX(-50%);\n            z-index: ${s.Constants.Z_INDEX.FLOATING_TOOLBAR};\n            width: ${s.Constants.UI_DIMENSIONS.TOOLBAR.WIDTH}px;\n            height: ${s.Constants.UI_DIMENSIONS.TOOLBAR.HEIGHT}px;\n            display: none;\n            pointer-events: auto;\n            user-select: none;\n        `,this.shadowRoot=this.element.attachShadow({mode:"open"}),a.ThemeManager.injectThemeCSS(this.shadowRoot),a.ThemeManager.watchThemeChanges(this.shadowRoot),this.shadowRoot.innerHTML='\n            <div class="toolbar netherite-glass netherite-metallic netherite-animate-fade-in">\n                <div class="toolbar-content">\n                    <button class="toolbar-btn" id="viewBtn" title="Analyze Page (View Mode)">\n                        <span class="icon">👁️</span>\n                        <span class="label">View</span>\n                    </button>\n                    <button class="toolbar-btn" id="chatBtn" title="Open Chat Assistant">\n                        <span class="icon">💬</span>\n                        <span class="label">Chat</span>\n                    </button>\n                    <button class="toolbar-btn disabled" id="voiceBtn" title="Voice Assistant (Coming Soon)">\n                        <span class="icon">🎤</span>\n                        <span class="label">Voice</span>\n                    </button>\n                </div>\n                <div class="drag-handle" title="Drag to move toolbar"></div>\n            </div>\n\n            <style>\n                .toolbar {\n                    width: 100%;\n                    height: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    cursor: move;\n                    position: relative;\n                    overflow: hidden;\n                }\n\n                .toolbar-content {\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-around;\n                    height: 100%;\n                    padding: 8px 12px;\n                }\n\n                .toolbar-btn {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    background: transparent;\n                    border: none;\n                    cursor: pointer;\n                    padding: 6px 8px;\n                    border-radius: 8px;\n                    transition: all 0.2s ease;\n                    color: var(--netherite-text-primary);\n                    min-width: 50px;\n                }\n\n                .toolbar-btn:hover:not(.disabled) {\n                    background: var(--netherite-hover-bg);\n                    transform: translateY(-1px);\n                }\n\n                .toolbar-btn:active:not(.disabled) {\n                    background: var(--netherite-active-bg);\n                    transform: translateY(0);\n                }\n\n                .toolbar-btn.disabled {\n                    opacity: 0.5;\n                    cursor: not-allowed;\n                }\n\n                .toolbar-btn .icon {\n                    font-size: 18px;\n                    margin-bottom: 2px;\n                }\n\n                .toolbar-btn .label {\n                    font-size: 10px;\n                    font-weight: 600;\n                    text-transform: uppercase;\n                    letter-spacing: 0.5px;\n                }\n\n                .toolbar-btn#viewBtn:hover:not(.disabled) .icon {\n                    filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6));\n                }\n\n                .toolbar-btn#chatBtn:hover:not(.disabled) .icon {\n                    filter: drop-shadow(0 0 8px rgba(147, 51, 234, 0.6));\n                }\n\n                .drag-handle {\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    cursor: move;\n                    z-index: -1;\n                }\n\n                .toolbar.dragging {\n                    transform: scale(1.05);\n                    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);\n                }\n\n                /* Responsive adjustments */\n                @media (max-width: 768px) {\n                    .toolbar-content {\n                        padding: 6px 8px;\n                    }\n                    \n                    .toolbar-btn {\n                        min-width: 40px;\n                        padding: 4px 6px;\n                    }\n                    \n                    .toolbar-btn .icon {\n                        font-size: 16px;\n                    }\n                    \n                    .toolbar-btn .label {\n                        font-size: 9px;\n                    }\n                }\n            </style>\n        ',document.body.appendChild(this.element),o.Logger.ui("Floating toolbar created","FloatingToolbar")}setupEventListeners(){if(!this.shadowRoot)return;const e=this.shadowRoot.getElementById("viewBtn"),t=this.shadowRoot.getElementById("chatBtn"),n=this.shadowRoot.getElementById("voiceBtn");e?.addEventListener("click",e=>{e.stopPropagation(),this.handleViewClick()}),t?.addEventListener("click",e=>{e.stopPropagation(),this.handleChatClick()}),n?.addEventListener("click",e=>{e.stopPropagation(),n.classList.contains("disabled")||this.handleVoiceClick()});const s=this.shadowRoot.querySelector(".toolbar");s&&(s.addEventListener("mousedown",this.handleDragStart.bind(this)),document.addEventListener("mousemove",this.handleDragMove.bind(this)),document.addEventListener("mouseup",this.handleDragEnd.bind(this))),document.addEventListener("keydown",e=>{e.altKey&&"KeyN"===e.code&&(e.preventDefault(),this.toggle())}),o.Logger.debug("Event listeners set up for floating toolbar")}handleViewClick(){o.Logger.ui("View button clicked","FloatingToolbar");const e=new CustomEvent("netherite:view-mode",{detail:{timestamp:Date.now()}});document.dispatchEvent(e)}handleChatClick(){o.Logger.ui("Chat button clicked","FloatingToolbar");const e=new CustomEvent("netherite:chat-mode",{detail:{timestamp:Date.now()}});document.dispatchEvent(e)}handleVoiceClick(){o.Logger.ui("Voice button clicked (not implemented)","FloatingToolbar");const e=new CustomEvent("netherite:voice-mode",{detail:{timestamp:Date.now()}});document.dispatchEvent(e)}handleDragStart(e){if(!this.element)return;this.isDragging=!0;const t=this.element.getBoundingClientRect();this.dragOffset={x:e.clientX-t.left,y:e.clientY-t.top};const n=this.shadowRoot?.querySelector(".toolbar");n?.classList.add("dragging"),document.body.style.cursor="move",o.Logger.debug("Drag started")}handleDragMove(e){if(!this.isDragging||!this.element)return;e.preventDefault();const t=e.clientX-this.dragOffset.x,n=e.clientY-this.dragOffset.y,s=window.innerWidth-this.element.offsetWidth,a=window.innerHeight-this.element.offsetHeight,i=Math.max(0,Math.min(t,s)),o=Math.max(0,Math.min(n,a));this.element.style.left=`${i}px`,this.element.style.top=`${o}px`,this.element.style.transform="none"}handleDragEnd(){if(!this.isDragging||!this.element)return;this.isDragging=!1;const e=this.shadowRoot?.querySelector(".toolbar");e?.classList.remove("dragging"),document.body.style.cursor="";const t=this.element.getBoundingClientRect();i.StorageManager.saveToolbarPosition(t.left,t.top),o.Logger.debug("Drag ended, position saved")}async loadSavedPosition(){const e=await i.StorageManager.getToolbarPosition();e&&this.element&&(this.element.style.left=`${e.x}px`,this.element.style.top=`${e.y}px`,this.element.style.transform="none",o.Logger.debug("Loaded saved toolbar position",e))}show(){this.element&&!this.isVisible&&(this.element.style.display="block",this.isVisible=!0,setTimeout(()=>{const e=this.shadowRoot?.querySelector(".toolbar");e?.classList.add("netherite-animate-fade-in")},10),o.Logger.ui("Floating toolbar shown","FloatingToolbar"))}hide(){this.element&&this.isVisible&&(this.element.style.display="none",this.isVisible=!1,o.Logger.ui("Floating toolbar hidden","FloatingToolbar"))}toggle(){this.isVisible?this.hide():this.show()}isToolbarVisible(){return this.isVisible}updateButtonStates(e){if(this.shadowRoot){if(this.shadowRoot.querySelectorAll(".toolbar-btn").forEach(e=>e.classList.remove("active")),e){const t=this.shadowRoot.getElementById(`${e}Btn`);t?.classList.add("active")}o.Logger.debug("Button states updated",{activeMode:e})}}destroy(){this.element&&(a.ThemeManager.removeObserver(this.shadowRoot),document.body.removeChild(this.element),this.element=null,this.shadowRoot=null),o.Logger.ui("Floating toolbar destroyed","FloatingToolbar")}}},139:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0;class n{}t.Constants=n,n.Z_INDEX={FLOATING_TOOLBAR:2147483647,SCANNER_OVERLAY:2147483646,CHAT_PANEL:2147483645,VIEW_PANEL:2147483644},n.IDS={FLOATING_TOOLBAR:"netherite-floating-toolbar",CHAT_PANEL:"netherite-chat-panel",VIEW_PANEL:"netherite-view-panel",SCANNER_OVERLAY:"netherite-scanner-overlay"},n.CLASSES={GLASS:"netherite-glass",GLASS_DARK:"netherite-glass-dark",METALLIC:"netherite-metallic",METALLIC_DARK:"netherite-metallic-dark",DARK_MODE:"netherite-dark-mode",SCANNER:"netherite-scanner",HIDDEN:"netherite-hidden",DRAGGING:"netherite-dragging"},n.ANIMATIONS={SCANNER_DURATION:2e3,FADE_DURATION:300,SLIDE_DURATION:400},n.STORAGE_KEYS={CURRENT_DOCUMENT:"netherite_current_document",CHAT_HISTORY:"netherite_chat_history",USER_PREFERENCES:"netherite_preferences",TOOLBAR_POSITION:"netherite_toolbar_position"},n.SHORTCUTS={ACTIVATE_TOOLBAR:"Alt+KeyN"},n.FIELD_TYPES={TEXT:["text","email","password","tel","url"],TEXTAREA:["textarea"],SELECT:["select-one","select-multiple"],DATE:["date","datetime-local","time"],NUMBER:["number","range"],CHECKBOX:["checkbox"],RADIO:["radio"],FILE:["file"]},n.AI_LIMITS={MAX_CHAT_HISTORY:50,MAX_DOCUMENT_SIZE:1e4,MAX_RETRY_ATTEMPTS:5,BASE_RETRY_DELAY:1e3},n.UI_DIMENSIONS={TOOLBAR:{WIDTH:200,HEIGHT:60},CHAT_PANEL:{WIDTH:600,HEIGHT:700},VIEW_PANEL:{WIDTH:500,HEIGHT:400}}},167:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0;const s=n(139),a=n(628);t.StorageManager=class{static async saveDocument(e){try{await chrome.storage.local.set({[s.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]:e}),a.Logger.success("Document saved to storage",e.name)}catch(e){throw a.Logger.error("Failed to save document:",e),e}}static async getCurrentDocument(){try{const e=(await chrome.storage.local.get([s.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]))[s.Constants.STORAGE_KEYS.CURRENT_DOCUMENT];return e?(a.Logger.info("Document retrieved from storage",e.name),e):(a.Logger.debug("No document found in storage"),null)}catch(e){return a.Logger.error("Failed to retrieve document:",e),null}}static async removeDocument(){try{await chrome.storage.local.remove([s.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]),a.Logger.success("Document removed from storage")}catch(e){throw a.Logger.error("Failed to remove document:",e),e}}static async saveChatHistory(e){try{const t=e.slice(-s.Constants.AI_LIMITS.MAX_CHAT_HISTORY);await chrome.storage.local.set({[s.Constants.STORAGE_KEYS.CHAT_HISTORY]:t}),a.Logger.debug("Chat history saved",`${t.length} messages`)}catch(e){throw a.Logger.error("Failed to save chat history:",e),e}}static async getChatHistory(){try{const e=(await chrome.storage.local.get([s.Constants.STORAGE_KEYS.CHAT_HISTORY]))[s.Constants.STORAGE_KEYS.CHAT_HISTORY]||[];return a.Logger.debug("Chat history retrieved",`${e.length} messages`),e}catch(e){return a.Logger.error("Failed to retrieve chat history:",e),[]}}static async clearChatHistory(){try{await chrome.storage.local.remove([s.Constants.STORAGE_KEYS.CHAT_HISTORY]),a.Logger.success("Chat history cleared")}catch(e){throw a.Logger.error("Failed to clear chat history:",e),e}}static async saveToolbarPosition(e,t){try{await chrome.storage.local.set({[s.Constants.STORAGE_KEYS.TOOLBAR_POSITION]:{x:e,y:t}}),a.Logger.debug("Toolbar position saved",`x: ${e}, y: ${t}`)}catch(e){a.Logger.warn("Failed to save toolbar position:",e)}}static async getToolbarPosition(){try{const e=(await chrome.storage.local.get([s.Constants.STORAGE_KEYS.TOOLBAR_POSITION]))[s.Constants.STORAGE_KEYS.TOOLBAR_POSITION];return e&&"number"==typeof e.x&&"number"==typeof e.y?(a.Logger.debug("Toolbar position retrieved",e),e):null}catch(e){return a.Logger.warn("Failed to retrieve toolbar position:",e),null}}static async savePreferences(e){try{await chrome.storage.local.set({[s.Constants.STORAGE_KEYS.USER_PREFERENCES]:e}),a.Logger.debug("User preferences saved")}catch(e){throw a.Logger.error("Failed to save user preferences:",e),e}}static async getPreferences(){try{return(await chrome.storage.local.get([s.Constants.STORAGE_KEYS.USER_PREFERENCES]))[s.Constants.STORAGE_KEYS.USER_PREFERENCES]||{}}catch(e){return a.Logger.error("Failed to retrieve user preferences:",e),{}}}static async exportChatHistory(){const e=await this.getChatHistory(),t=((new Date).toISOString(),e.map(e=>`[${new Date(e.timestamp).toLocaleString()}] ${e.role.toUpperCase()}: ${e.content}`).join("\n\n"));return`Netherite Chat History Export\nExported: ${(new Date).toLocaleString()}\n\n${"=".repeat(50)}\n\n`+t}static async getStorageStats(){try{const e=await chrome.storage.local.get(null),t=new TextEncoder;let n=0,a=0;return e[s.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]&&(n=t.encode(JSON.stringify(e[s.Constants.STORAGE_KEYS.CURRENT_DOCUMENT])).length),e[s.Constants.STORAGE_KEYS.CHAT_HISTORY]&&(a=t.encode(JSON.stringify(e[s.Constants.STORAGE_KEYS.CHAT_HISTORY])).length),{documentsSize:n,chatHistorySize:a,totalSize:n+a}}catch(e){return a.Logger.error("Failed to get storage stats:",e),{documentsSize:0,chatHistorySize:0,totalSize:0}}}}},271:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SystemPrompts=void 0,t.SystemPrompts=class{static getViewModePrompt(){return"You are a web page analyzer. Analyze the provided HTML structure and:\n1. Identify the page purpose (e.g., job application, contact form, registration, survey)\n2. List all form fields with their labels and types in a structured format\n3. Summarize the page content in 2-3 sentences\n4. Highlight any required fields or special instructions\n5. Note any character limits or validation requirements\n\nFormat your response as a structured summary with clear sections:\n- Purpose: [Brief description]\n- Form Fields: [Numbered list with field name, type, and requirements]\n- Summary: [2-3 sentence overview]\n- Special Notes: [Any important requirements or constraints]"}static getChatModePrompt(e){const{pagePurpose:t,fieldsList:n,documentContent:s}=e;return`You are Netherite, an AI assistant helping users fill web forms intelligently.\n\nContext:\n- Page Purpose: ${t||"General web form"}\n- Detected Fields: ${n||"No fields detected"}\n- User Document: ${s?"Available for reference":"No document uploaded"}\n\nYour task:\n1. Understand the user's intent from their message\n2. Generate appropriate answers for form fields based on the user's document and context\n3. Provide answers in a structured format with emojis:\n   📝 [Field Name] → [Answer]\n4. Be concise but complete - match the expected format for each field type\n5. Ask for clarification if critical information is missing\n6. For text areas, respect character limits mentioned in field descriptions\n\nAlways maintain context from previous messages in this conversation.\nIf the user references @doc, use the document content to generate personalized responses.`}static getRewriteModePrompt(e){const{fieldType:t,fieldLabel:n,characterLimit:s}=e;return`You are a content refinement assistant. Rewrite the provided text to be:\n- More professional and polished\n- Grammatically correct and well-structured\n- Concise but complete\n- Appropriate for the context: ${n} (${t})\n${s?`- Within ${s} character limit`:""}\n\nMaintain the original meaning and key information while improving clarity and impact.\nReturn only the rewritten content without explanations or formatting.`}static getSystemPrompt(e,t){switch(e){case"view":return this.getViewModePrompt();case"chat":return this.getChatModePrompt(t||{});case"rewrite":return this.getRewriteModePrompt(t||{fieldType:"text",fieldLabel:"field"});default:throw new Error(`Unknown AI mode: ${e}`)}}}},323:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ViewModeScanner=void 0;const s=n(139),a=n(560),i=n(628),o=n(38),r=n(922);t.ViewModeScanner=class{constructor(){this.scannerElement=null,this.resultPanel=null,this.shadowRoot=null,this.isScanning=!1,this.createScannerElement()}createScannerElement(){this.scannerElement=document.createElement("div"),this.scannerElement.id=s.Constants.IDS.SCANNER_OVERLAY,this.scannerElement.style.cssText=`\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 4px;\n            z-index: ${s.Constants.Z_INDEX.SCANNER_OVERLAY};\n            display: none;\n            pointer-events: none;\n        `,this.scannerElement.className=s.Constants.CLASSES.SCANNER,document.body.appendChild(this.scannerElement),i.Logger.ui("Scanner overlay created","ViewModeScanner")}async scanPage(){if(this.isScanning)i.Logger.warn("Scan already in progress");else try{this.isScanning=!0,i.Logger.ui("Starting page scan","ViewModeScanner"),this.startScanAnimation();const e=await this.analyzePageContent();setTimeout(()=>{this.showAnalysisResults(e)},s.Constants.ANIMATIONS.SCANNER_DURATION)}catch(e){i.Logger.error("Error during page scan:",e),this.showError("Failed to analyze page. Please try again.")}finally{this.isScanning=!1}}startScanAnimation(){this.scannerElement&&(this.scannerElement.style.display="block",this.scannerElement.style.animation=`netherite-scan-effect ${s.Constants.ANIMATIONS.SCANNER_DURATION}ms ease-in-out`,setTimeout(()=>{this.scannerElement&&(this.scannerElement.style.display="none",this.scannerElement.style.animation="")},s.Constants.ANIMATIONS.SCANNER_DURATION),i.Logger.debug("Scan animation started"))}async analyzePageContent(){const e=o.AIServiceFactory.getInstance(),t=new r.FormFieldDetector,n=this.getPageContent(),s=t.detectFields();return i.Logger.debug("Page analysis started",{htmlLength:n.html.length,formFieldsCount:s.length}),{aiAnalysis:await e.analyzeWebpage(n.html,n.title,n.url),formFields:s,pageInfo:n,timestamp:Date.now()}}getPageContent(){const e=["main","article",'[role="main"]',".content","#content",".main-content","section"];let t="";for(const n of e){const e=document.querySelectorAll(n);if(e.length>0){e.forEach(e=>{t+=e.outerHTML});break}}if(!t){const e=document.body.cloneNode(!0);e.querySelectorAll('script, style, noscript, [id^="netherite"], [class*="netherite"], iframe, .ads, .advertisement').forEach(e=>e.remove()),t=e.innerHTML}return t.length>8e3&&(t=t.substring(0,8e3)+"\n... [content truncated for analysis]"),{html:t,title:document.title,url:window.location.href}}showAnalysisResults(e){this.createResultPanel(e);const t=new CustomEvent("netherite:view-complete",{detail:e});document.dispatchEvent(t),i.Logger.ui("Analysis results displayed","ViewModeScanner")}createResultPanel(e){this.removeResultPanel(),this.resultPanel=document.createElement("div"),this.resultPanel.id=s.Constants.IDS.VIEW_PANEL,this.resultPanel.style.cssText=`\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            width: ${s.Constants.UI_DIMENSIONS.VIEW_PANEL.WIDTH}px;\n            max-height: ${s.Constants.UI_DIMENSIONS.VIEW_PANEL.HEIGHT}px;\n            z-index: ${s.Constants.Z_INDEX.VIEW_PANEL};\n            pointer-events: auto;\n        `,this.shadowRoot=this.resultPanel.attachShadow({mode:"open"}),a.ThemeManager.injectThemeCSS(this.shadowRoot),a.ThemeManager.watchThemeChanges(this.shadowRoot),this.shadowRoot.innerHTML=`\n            <div class="view-panel netherite-glass netherite-animate-fade-in">\n                <div class="panel-header">\n                    <h2>📄 Page Analysis</h2>\n                    <div class="panel-actions">\n                        <button id="openChatBtn" class="action-btn primary">\n                            💬 Open Chat\n                        </button>\n                        <button id="closeBtn" class="close-btn">×</button>\n                    </div>\n                </div>\n                \n                <div class="panel-content">\n                    <div class="analysis-section">\n                        ${this.formatAnalysisResults(e)}\n                    </div>\n                </div>\n            </div>\n\n            <style>\n                .view-panel {\n                    width: 100%;\n                    max-height: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    overflow: hidden;\n                }\n\n                .panel-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    padding: 20px 24px 16px;\n                    border-bottom: 1px solid var(--netherite-border);\n                }\n\n                .panel-header h2 {\n                    margin: 0;\n                    font-size: 18px;\n                    font-weight: 600;\n                    color: var(--netherite-text-primary);\n                }\n\n                .panel-actions {\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n\n                .action-btn {\n                    padding: 8px 16px;\n                    border: none;\n                    border-radius: 8px;\n                    font-size: 14px;\n                    font-weight: 500;\n                    cursor: pointer;\n                    transition: all 0.2s ease;\n                }\n\n                .action-btn.primary {\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    color: white;\n                }\n\n                .action-btn.primary:hover {\n                    transform: translateY(-1px);\n                    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n                }\n\n                .close-btn {\n                    width: 32px;\n                    height: 32px;\n                    border: none;\n                    border-radius: 50%;\n                    background: var(--netherite-hover-bg);\n                    color: var(--netherite-text-secondary);\n                    font-size: 18px;\n                    font-weight: bold;\n                    cursor: pointer;\n                    transition: all 0.2s ease;\n                }\n\n                .close-btn:hover {\n                    background: var(--netherite-active-bg);\n                    color: var(--netherite-text-primary);\n                }\n\n                .panel-content {\n                    flex: 1;\n                    overflow-y: auto;\n                    padding: 0 24px 24px;\n                }\n\n                .analysis-section {\n                    color: var(--netherite-text-primary);\n                    line-height: 1.6;\n                }\n\n                .analysis-section h3 {\n                    color: var(--netherite-text-accent);\n                    font-size: 16px;\n                    margin: 20px 0 12px 0;\n                }\n\n                .analysis-section p {\n                    margin: 8px 0;\n                }\n\n                .field-list {\n                    list-style: none;\n                    padding: 0;\n                    margin: 12px 0;\n                }\n\n                .field-item {\n                    display: flex;\n                    align-items: center;\n                    padding: 8px 12px;\n                    margin: 4px 0;\n                    background: var(--netherite-bg-secondary);\n                    border-radius: 6px;\n                    font-size: 14px;\n                }\n\n                .field-type {\n                    background: var(--netherite-text-accent);\n                    color: white;\n                    padding: 2px 8px;\n                    border-radius: 12px;\n                    font-size: 12px;\n                    margin-left: 8px;\n                }\n\n                .required {\n                    color: #ef4444;\n                    font-weight: 600;\n                }\n\n                /* Scrollbar styling */\n                .panel-content::-webkit-scrollbar {\n                    width: 6px;\n                }\n\n                .panel-content::-webkit-scrollbar-track {\n                    background: var(--netherite-bg-secondary);\n                    border-radius: 3px;\n                }\n\n                .panel-content::-webkit-scrollbar-thumb {\n                    background: var(--netherite-text-secondary);\n                    border-radius: 3px;\n                }\n\n                .panel-content::-webkit-scrollbar-thumb:hover {\n                    background: var(--netherite-text-primary);\n                }\n            </style>\n        `,this.setupResultPanelEvents(),document.body.appendChild(this.resultPanel),i.Logger.ui("Results panel created and displayed","ViewModeScanner")}formatAnalysisResults(e){const{aiAnalysis:t,formFields:n,pageInfo:s}=e;let a=`\n            <div class="ai-analysis">\n                <h3>🤖 AI Analysis</h3>\n                <div class="analysis-content">\n                    ${this.formatAIAnalysisText(t)}\n                </div>\n            </div>\n        `;return n&&n.length>0&&(a+=`\n                <div class="detected-fields">\n                    <h3>📝 Detected Form Fields (${n.length})</h3>\n                    <ul class="field-list">\n                        ${n.map(e=>`\n                            <li class="field-item">\n                                <span>${e.label||"Unlabeled field"}</span>\n                                <span class="field-type">${e.type}</span>\n                                ${e.required?'<span class="required">*</span>':""}\n                            </li>\n                        `).join("")}\n                    </ul>\n                </div>\n            `),a}formatAIAnalysisText(e){return e.replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/^/,"<p>").replace(/$/,"</p>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>")}setupResultPanelEvents(){if(!this.shadowRoot)return;const e=this.shadowRoot.getElementById("closeBtn"),t=this.shadowRoot.getElementById("openChatBtn");e?.addEventListener("click",()=>{this.removeResultPanel()}),t?.addEventListener("click",()=>{this.removeResultPanel();const e=new CustomEvent("netherite:chat-mode",{detail:{fromViewMode:!0}});document.dispatchEvent(e)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.resultPanel&&this.removeResultPanel()})}removeResultPanel(){this.resultPanel&&(a.ThemeManager.removeObserver(this.shadowRoot),document.body.removeChild(this.resultPanel),this.resultPanel=null,this.shadowRoot=null,i.Logger.ui("Results panel removed","ViewModeScanner"))}showError(e){console.error("[Netherite ViewScanner]:",e);const t=document.createElement("div");t.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: #ef4444;\n            color: white;\n            padding: 12px 20px;\n            border-radius: 8px;\n            z-index: ${s.Constants.Z_INDEX.FLOATING_TOOLBAR+1};\n            font-family: system-ui, sans-serif;\n        `,t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},5e3)}isCurrentlyScanning(){return this.isScanning}destroy(){this.removeResultPanel(),this.scannerElement&&(document.body.removeChild(this.scannerElement),this.scannerElement=null),i.Logger.ui("ViewModeScanner destroyed","ViewModeScanner")}}},346:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PromptAPIService=void 0;const s=n(271),a=n(628);class i{constructor(){this.session=null}static async checkAvailability(){try{if("undefined"==typeof LanguageModel)return a.Logger.warn("LanguageModel API not available in this browser"),!1;const e=await LanguageModel.capabilities();return a.Logger.info("AI Capabilities:",e),"readily"===e.available||"after-download"===e.available}catch(e){return a.Logger.error("Error checking AI availability:",e),!1}}async fetchWithRetry(e,t=5,n=1e3){for(let s=0;s<t;s++)try{return await e()}catch(e){if(s===t-1)throw e;const i=n*Math.pow(2,s);a.Logger.warn(`Retry attempt ${s+1} failed, waiting ${i}ms...`,e),await new Promise(e=>setTimeout(e,i))}throw new Error("All retry attempts failed")}async createSession(e,t){return this.fetchWithRetry(async()=>{const n=s.SystemPrompts.getSystemPrompt(e,t);a.Logger.info(`Creating AI session for mode: ${e}`),a.Logger.debug("System prompt:",n);const i=await LanguageModel.create({systemPrompt:n,temperature:.7,topK:40});return a.Logger.info("AI session created successfully"),i})}async generateContent(e,t,n){if(!await i.checkAvailability())throw new Error("AI Language Model is not available. Please check Chrome flags and model download.");let s=null;try{s=await this.createSession(t,n),a.Logger.info(`Generating content for mode: ${t}`),a.Logger.debug("User prompt:",e);const i=await this.fetchWithRetry(()=>s.prompt(e));return a.Logger.info("Content generated successfully"),a.Logger.debug("AI response length:",i.length),i}catch(e){throw a.Logger.error("Error during AI generation:",e),new Error(`Generation failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{if(s)try{s.destroy(),a.Logger.debug("AI session destroyed successfully")}catch(e){a.Logger.warn("Error destroying AI session:",e)}}}async analyzeWebpage(e,t,n){const s=`Analyze this webpage:\n\nHTML Structure:\n${e}\n\nPage Title: ${t}\nURL: ${n}\n\nProvide a comprehensive analysis following the specified format.`;return this.generateContent(s,"view")}async generateChatResponse(e,t,n){const s=`Previous Conversation:\n${t.slice(-10).map(e=>`${e.role}: ${e.content}`).join("\n")}\n\nUser Message: ${e}\n\nGenerate structured answers for the detected form fields based on the context and user's document (if available).`;return this.generateContent(s,"chat",n)}async rewriteContent(e,t,n,s){const a=`Original Text:\n${e}\n\nRewrite this content for the field "${t}" (${n}).`,i={fieldType:n,fieldLabel:t,characterLimit:s};return this.generateContent(a,"rewrite",i)}destroy(){if(this.session)try{this.session.destroy(),this.session=null,a.Logger.info("PromptAPIService cleaned up")}catch(e){a.Logger.warn("Error during PromptAPIService cleanup:",e)}}}t.PromptAPIService=i},560:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeManager=void 0;const s=n(628);class a{static isDarkMode(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static applyTheme(e){const t=this.isDarkMode(),n=e.host;t?(n.classList.add("netherite-dark-mode"),this.currentTheme="dark"):(n.classList.remove("netherite-dark-mode"),this.currentTheme="light"),s.Logger.ui("Theme applied: "+(t?"dark":"light"),"ThemeManager")}static watchThemeChanges(e){this.observers.add(e),this.applyTheme(e);const t=window.matchMedia("(prefers-color-scheme: dark)"),n=()=>{s.Logger.debug("System theme changed"),this.updateAllObservers()};t.addEventListener?t.addEventListener("change",n):t.addListener(n)}static updateAllObservers(){for(const e of this.observers)try{this.applyTheme(e)}catch(t){s.Logger.warn("Failed to update theme for shadow root:",t),this.observers.delete(e)}}static getThemeVariables(){const e="dark"===this.currentTheme;return{"--netherite-glass-bg":e?"rgba(30, 30, 30, 0.7)":"rgba(255, 255, 255, 0.15)","--netherite-glass-border":e?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.3)","--netherite-glass-shadow":e?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 8px 32px rgba(0, 0, 0, 0.1)","--netherite-glass-inset":e?"inset 0 1px 0 rgba(255, 255, 255, 0.1)":"inset 0 1px 0 rgba(255, 255, 255, 0.5)","--netherite-metallic-bg":e?"linear-gradient(135deg, rgba(60, 60, 60, 0.3) 0%, rgba(40, 40, 40, 0.2) 50%, rgba(60, 60, 60, 0.3) 100%)":"linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(200, 200, 200, 0.1) 50%, rgba(255, 255, 255, 0.2) 100%)","--netherite-text-primary":e?"#ffffff":"#1f2937","--netherite-text-secondary":e?"#d1d5db":"#6b7280","--netherite-text-accent":e?"#60a5fa":"#3b82f6","--netherite-bg-primary":e?"#111827":"#ffffff","--netherite-bg-secondary":e?"#1f2937":"#f9fafb","--netherite-border":e?"#374151":"#e5e7eb","--netherite-hover-bg":e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.05)","--netherite-active-bg":e?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.1)","--netherite-scanner-color":"rgba(59, 130, 246, 0.8)","--netherite-scanner-glow":"0 0 20px rgba(59, 130, 246, 0.6)"}}static injectThemeCSS(e){const t=this.getThemeVariables();let n=":host {\n";for(const[e,s]of Object.entries(t))n+=`  ${e}: ${s};\n`;n+="}\n",n+=this.getGlassmorphicCSS();const a=document.createElement("style");a.textContent=n,e.insertBefore(a,e.firstChild),s.Logger.debug("Theme CSS injected into shadow root")}static getGlassmorphicCSS(){return"\n.netherite-glass {\n    background: var(--netherite-glass-bg);\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    border: 1px solid var(--netherite-glass-border);\n    box-shadow: var(--netherite-glass-shadow), var(--netherite-glass-inset);\n    border-radius: 16px;\n}\n\n.netherite-metallic {\n    background: var(--netherite-metallic-bg);\n}\n\n.netherite-scanner {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 4px;\n    background: linear-gradient(90deg, transparent, var(--netherite-scanner-color), transparent);\n    box-shadow: var(--netherite-scanner-glow);\n    z-index: 2147483646;\n}\n\n.netherite-hidden {\n    display: none !important;\n}\n\n.netherite-dragging {\n    pointer-events: none;\n    user-select: none;\n}\n\n/* Smooth transitions */\n.netherite-glass,\n.netherite-metallic {\n    transition: all 0.3s ease;\n}\n\n/* Hover effects */\n.netherite-glass:hover {\n    background: var(--netherite-hover-bg);\n    transform: translateY(-1px);\n}\n\n/* Animation keyframes */\n@keyframes netherite-scan-effect {\n    0% {\n        top: 0;\n        opacity: 0.8;\n    }\n    100% {\n        top: 100%;\n        opacity: 0;\n    }\n}\n\n@keyframes netherite-fade-in {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes netherite-slide-up {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.netherite-animate-scan {\n    animation: netherite-scan-effect 2s ease-in-out;\n}\n\n.netherite-animate-fade-in {\n    animation: netherite-fade-in 0.3s ease-out;\n}\n\n.netherite-animate-slide-up {\n    animation: netherite-slide-up 0.4s ease-out;\n}\n        "}static removeObserver(e){this.observers.delete(e),s.Logger.debug("Shadow root removed from theme observers")}static getCurrentTheme(){return this.currentTheme}static forceUpdate(){this.updateAllObservers(),s.Logger.debug("Forced theme update on all observers")}}t.ThemeManager=a,a.currentTheme="light",a.observers=new Set},628:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;class n{static info(e,...t){(this.isDevelopment||this.shouldLog("info"))&&console.info(`${this.PREFIX} ℹ️`,e,...t)}static warn(e,...t){(this.isDevelopment||this.shouldLog("warn"))&&console.warn(`${this.PREFIX} ⚠️`,e,...t)}static error(e,...t){console.error(`${this.PREFIX} ❌`,e,...t)}static debug(e,...t){this.isDevelopment&&console.debug(`${this.PREFIX} 🐛`,e,...t)}static success(e,...t){(this.isDevelopment||this.shouldLog("info"))&&console.log(`${this.PREFIX} ✅`,e,...t)}static trace(e,t){if(this.isDevelopment){const n=t?` (${t}ms)`:"";console.log(`${this.PREFIX} 📊 ${e}${n}`)}}static aiSession(e,t){this.isDevelopment&&console.log(`${this.PREFIX} ${{create:"🚀",prompt:"💭",destroy:"🗑️"}[e]} AI Session ${e}`,t||"")}static ui(e,t,n){this.isDevelopment&&console.log(`${this.PREFIX} 🎨 UI [${t}] ${e}`,n||"")}static chromeAPI(e,t,n){this.isDevelopment&&console.log(`${this.PREFIX} 🔌 Chrome.${e} ${t}`,n||"")}static shouldLog(e){return"warn"===e}static startTimer(e){const t=performance.now();return()=>{const n=Math.round(performance.now()-t);this.trace(e,n)}}static field(e,t,n=!0){const s=n?"✅":"❌";this.isDevelopment&&console.log(`${this.PREFIX} 📝 Field ${e}: ${t} ${s}`)}}t.Logger=n,n.PREFIX="[Netherite]",n.isDevelopment=!0},922:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FormFieldDetector=void 0;const s=n(628);t.FormFieldDetector=class{constructor(){this.detectedFields=[],this.detectFields()}detectFields(){this.detectedFields=[],s.Logger.info("Starting form field detection...");const e=document.querySelectorAll("form"),t=document.querySelectorAll("input, textarea, select");return e.forEach(e=>{this.processFormElements(e)}),t.forEach(e=>{e.closest("form")||this.processFieldElement(e)}),this.detectedFields=this.filterAndDeduplicateFields(this.detectedFields),s.Logger.success(`Form field detection complete: ${this.detectedFields.length} fields found`),this.detectedFields}processFormElements(e){const t=e.querySelectorAll("input, textarea, select");t.forEach(e=>{this.processFieldElement(e)}),s.Logger.field("detect",`form with ${t.length} inputs`)}processFieldElement(e){const t=e;if(this.shouldSkipField(t))return;const n=this.extractFieldInfo(t);n&&(this.detectedFields.push(n),s.Logger.field("detect",n.label||"unlabeled field",!0))}shouldSkipField(e){if("hidden"===e.type)return!0;if(e.disabled)return!0;if("readOnly"in e&&e.readOnly&&"type"in e&&"text"!==e.type)return!0;const t=(e.name||"").toLowerCase(),n=(e.id||"").toLowerCase();if(["csrf","token","_token","authenticity_token","utf8","_method","commit","submit","captcha","recaptcha","g-recaptcha-response"].some(e=>t.includes(e)||n.includes(e)))return!0;const s=window.getComputedStyle(e);return"none"===s.display||"hidden"===s.visibility}extractFieldInfo(e){try{const t=this.findFieldLabel(e),n=this.getFieldType(e),s=this.isFieldRequired(e);return{element:e,label:t,type:n,required:s,placeholder:"placeholder"in e&&e.placeholder||void 0,maxLength:this.getMaxLength(e)}}catch(e){return s.Logger.warn("Error extracting field info:",e),null}}findFieldLabel(e){if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t&&t.textContent)return this.cleanLabelText(t.textContent)}const t=e.closest("label");if(t&&t.textContent)return this.cleanLabelText(t.textContent);if(e.getAttribute("aria-label"))return this.cleanLabelText(e.getAttribute("aria-label"));const n=e.getAttribute("aria-labelledby");if(n){const e=document.getElementById(n);if(e&&e.textContent)return this.cleanLabelText(e.textContent)}if(e.title)return this.cleanLabelText(e.title);const s=e.placeholder;if(s)return this.cleanLabelText(s);const a=e.name;if(a)return this.formatNameAsLabel(a);const i=this.findNearbyText(e);return i?this.cleanLabelText(i):"Unlabeled field"}cleanLabelText(e){return e.trim().replace(/\s+/g," ").replace(/[*:]+$/,"").trim()}formatNameAsLabel(e){return e.replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase().replace(/^./,e=>e.toUpperCase())}findNearbyText(e){let t=e.previousElementSibling,n=0;for(;t&&n<3;){const e=t.textContent?.trim();if(e&&e.length>0&&e.length<100)return e;t=t.previousElementSibling,n++}const s=e.parentElement;if(s){const e=s.textContent?.trim();if(e&&e.length<100&&e.split(/\s+/).length<=10)return e}return null}getFieldType(e){if("TEXTAREA"===e.tagName)return"textarea";if("SELECT"===e.tagName)return e.multiple?"select-multiple":"select-one";const t=e.type.toLowerCase();return{text:"text",email:"email",password:"password",tel:"phone",url:"url",number:"number",range:"range",date:"date","datetime-local":"datetime",time:"time",month:"month",week:"week",color:"color",file:"file",checkbox:"checkbox",radio:"radio",submit:"submit",button:"button",reset:"reset",search:"search"}[t]||t}isFieldRequired(e){if(e.required)return!0;if("true"===e.getAttribute("aria-required"))return!0;const t=this.findFieldLabel(e);return!(!t.includes("*")&&!t.toLowerCase().includes("required"))}getMaxLength(e){if("maxLength"in e&&e.maxLength>0)return e.maxLength;const t=e.pattern;if(t){const e=t.match(/\{(\d+),?(\d+)?\}/);if(e)return parseInt(e[2]||e[1])}}filterAndDeduplicateFields(e){const t=new Set,n=[];for(const s of e){if(t.has(s.element))continue;const e=s.type.toLowerCase();["submit","button","reset","image"].includes(e)||(t.add(s.element),n.push(s))}return n}getDetectedFields(){return this.detectedFields}getFieldsByType(e){return this.detectedFields.filter(t=>t.type===e)}getRequiredFields(){return this.detectedFields.filter(e=>e.required)}getFormSummary(){if(0===this.detectedFields.length)return"No form fields detected on this page.";const e=this.detectedFields.map(e=>{const t=e.required?" (required)":"",n=e.maxLength?` (max: ${e.maxLength})`:"";return`- ${e.label}: ${e.type}${t}${n}`});return`Detected ${this.detectedFields.length} form fields:\n${e.join("\n")}`}refresh(){return s.Logger.info("Refreshing form field detection..."),this.detectFields()}}}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}(()=>{const e=n(122),t=n(323),s=n(107),a=n(922),i=n(38),o=n(628),r=new class{constructor(){this.floatingToolbar=null,this.viewModeScanner=null,this.chatPanel=null,this.formFieldDetector=null,this.isInitialized=!1,this.initialize()}async initialize(){try{o.Logger.info("Netherite content script initializing..."),await i.AIServiceFactory.isAvailable()||o.Logger.warn("AI services not available - extension functionality limited"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.setupComponents()}):this.setupComponents(),this.setupGlobalEventListeners(),this.setupExtensionCommands(),this.isInitialized=!0,o.Logger.success("Netherite content script initialized successfully")}catch(e){o.Logger.error("Failed to initialize Netherite content script:",e)}}setupComponents(){try{this.floatingToolbar=new e.FloatingToolbar,this.formFieldDetector=new a.FormFieldDetector,o.Logger.debug("UI components set up")}catch(e){o.Logger.error("Failed to set up UI components:",e)}}setupGlobalEventListeners(){document.addEventListener("netherite:view-mode",this.handleViewModeActivation.bind(this)),document.addEventListener("netherite:chat-mode",this.handleChatModeActivation.bind(this)),document.addEventListener("netherite:voice-mode",this.handleVoiceModeActivation.bind(this)),document.addEventListener("netherite:view-complete",this.handleViewModeComplete.bind(this)),document.addEventListener("netherite:chat-close",this.handleChatClose.bind(this)),document.addEventListener("visibilitychange",()=>{document.hidden?o.Logger.debug("Page became hidden"):o.Logger.debug("Page became visible")}),o.Logger.debug("Global event listeners set up")}setupExtensionCommands(){chrome?.commands&&chrome.commands.onCommand.addListener(e=>{o.Logger.chromeAPI("commands","onCommand",e),"toggle-toolbar"===e&&this.floatingToolbar?.toggle()}),chrome?.runtime&&chrome.runtime.onMessage.addListener((e,t,n)=>(o.Logger.chromeAPI("runtime","onMessage",e),this.handleRuntimeMessage(e,t,n),!0))}handleRuntimeMessage(e,t,n){switch(e.type){case"toggle-toolbar":this.floatingToolbar?.show(),n({success:!0});break;case"deactivate-toolbar":this.floatingToolbar?.hide(),n({success:!0});break;case"get-page-info":const t={title:document.title,url:window.location.href,formFields:this.formFieldDetector?.getDetectedFields()||[]};n(t);break;case"check-ai-status":i.AIServiceFactory.isAvailable().then(e=>{n({aiAvailable:e})});break;default:o.Logger.warn("Unknown runtime message type:",e.type),n({error:"Unknown message type"})}}async handleViewModeActivation(e){try{o.Logger.ui("View mode activated","ContentScript"),this.viewModeScanner||(this.viewModeScanner=new t.ViewModeScanner),this.floatingToolbar?.updateButtonStates("view"),await this.viewModeScanner.scanPage()}catch(e){o.Logger.error("Error activating view mode:",e)}}async handleChatModeActivation(e){try{o.Logger.ui("Chat mode activated","ContentScript"),this.chatPanel||(this.chatPanel=new s.ChatPanel),this.floatingToolbar?.updateButtonStates("chat"),this.chatPanel.show()}catch(e){o.Logger.error("Error activating chat mode:",e)}}handleVoiceModeActivation(e){o.Logger.ui("Voice mode activated (not implemented)","ContentScript")}handleViewModeComplete(e){o.Logger.ui("View mode analysis complete","ContentScript"),this.floatingToolbar?.updateButtonStates(null);const t=e.detail;t&&this.chatPanel&&this.chatPanel.setViewModeContext(t)}handleChatClose(e){o.Logger.ui("Chat panel closed","ContentScript"),this.floatingToolbar?.updateButtonStates(null)}getPageContent(){const e=document.querySelectorAll('main, article, section, .content, #content, [role="main"]');let t="";if(e.length>0)e.forEach(e=>{t+=e.outerHTML});else{const e=document.body.cloneNode(!0);e.querySelectorAll('script, style, noscript, [id^="netherite"], [class*="netherite"]').forEach(e=>e.remove()),t=e.innerHTML}return t.length>1e4&&(t=t.substring(0,1e4)+"... [content truncated]"),{html:t,title:document.title,url:window.location.href}}isReady(){return this.isInitialized}cleanup(){o.Logger.info("Cleaning up Netherite content script...");try{this.floatingToolbar?.destroy(),this.viewModeScanner?.destroy(),this.chatPanel?.destroy(),i.AIServiceFactory.cleanup(),o.Logger.success("Netherite content script cleaned up")}catch(e){o.Logger.error("Error during cleanup:",e)}}};window.addEventListener("beforeunload",()=>{r.cleanup()}),window.NetheriteContentScript=r})()})();