(()=>{"use strict";var e={139:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0;class o{}t.Constants=o,o.Z_INDEX={FLOATING_TOOLBAR:2147483647,SCANNER_OVERLAY:2147483646,CHAT_PANEL:2147483645,VIEW_PANEL:2147483644},o.IDS={FLOATING_TOOLBAR:"netherite-floating-toolbar",CHAT_PANEL:"netherite-chat-panel",VIEW_PANEL:"netherite-view-panel",SCANNER_OVERLAY:"netherite-scanner-overlay"},o.CLASSES={GLASS:"netherite-glass",GLASS_DARK:"netherite-glass-dark",METALLIC:"netherite-metallic",METALLIC_DARK:"netherite-metallic-dark",DARK_MODE:"netherite-dark-mode",SCANNER:"netherite-scanner",HIDDEN:"netherite-hidden",DRAGGING:"netherite-dragging"},o.ANIMATIONS={SCANNER_DURATION:2e3,FADE_DURATION:300,SLIDE_DURATION:400},o.STORAGE_KEYS={CURRENT_DOCUMENT:"netherite_current_document",CHAT_HISTORY:"netherite_chat_history",USER_PREFERENCES:"netherite_preferences",TOOLBAR_POSITION:"netherite_toolbar_position"},o.SHORTCUTS={ACTIVATE_TOOLBAR:"Alt+KeyN"},o.FIELD_TYPES={TEXT:["text","email","password","tel","url"],TEXTAREA:["textarea"],SELECT:["select-one","select-multiple"],DATE:["date","datetime-local","time"],NUMBER:["number","range"],CHECKBOX:["checkbox"],RADIO:["radio"],FILE:["file"]},o.AI_LIMITS={MAX_CHAT_HISTORY:50,MAX_DOCUMENT_SIZE:1e4,MAX_RETRY_ATTEMPTS:5,BASE_RETRY_DELAY:1e3},o.UI_DIMENSIONS={TOOLBAR:{WIDTH:200,HEIGHT:60},CHAT_PANEL:{WIDTH:600,HEIGHT:700},VIEW_PANEL:{WIDTH:500,HEIGHT:400}}},167:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0;const r=o(139),s=o(628);t.StorageManager=class{static async saveDocument(e){try{await chrome.storage.local.set({[r.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]:e}),s.Logger.success("Document saved to storage",e.name)}catch(e){throw s.Logger.error("Failed to save document:",e),e}}static async getCurrentDocument(){try{const e=(await chrome.storage.local.get([r.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]))[r.Constants.STORAGE_KEYS.CURRENT_DOCUMENT];return e?(s.Logger.info("Document retrieved from storage",e.name),e):(s.Logger.debug("No document found in storage"),null)}catch(e){return s.Logger.error("Failed to retrieve document:",e),null}}static async removeDocument(){try{await chrome.storage.local.remove([r.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]),s.Logger.success("Document removed from storage")}catch(e){throw s.Logger.error("Failed to remove document:",e),e}}static async saveChatHistory(e){try{const t=e.slice(-r.Constants.AI_LIMITS.MAX_CHAT_HISTORY);await chrome.storage.local.set({[r.Constants.STORAGE_KEYS.CHAT_HISTORY]:t}),s.Logger.debug("Chat history saved",`${t.length} messages`)}catch(e){throw s.Logger.error("Failed to save chat history:",e),e}}static async getChatHistory(){try{const e=(await chrome.storage.local.get([r.Constants.STORAGE_KEYS.CHAT_HISTORY]))[r.Constants.STORAGE_KEYS.CHAT_HISTORY]||[];return s.Logger.debug("Chat history retrieved",`${e.length} messages`),e}catch(e){return s.Logger.error("Failed to retrieve chat history:",e),[]}}static async clearChatHistory(){try{await chrome.storage.local.remove([r.Constants.STORAGE_KEYS.CHAT_HISTORY]),s.Logger.success("Chat history cleared")}catch(e){throw s.Logger.error("Failed to clear chat history:",e),e}}static async saveToolbarPosition(e,t){try{await chrome.storage.local.set({[r.Constants.STORAGE_KEYS.TOOLBAR_POSITION]:{x:e,y:t}}),s.Logger.debug("Toolbar position saved",`x: ${e}, y: ${t}`)}catch(e){s.Logger.warn("Failed to save toolbar position:",e)}}static async getToolbarPosition(){try{const e=(await chrome.storage.local.get([r.Constants.STORAGE_KEYS.TOOLBAR_POSITION]))[r.Constants.STORAGE_KEYS.TOOLBAR_POSITION];return e&&"number"==typeof e.x&&"number"==typeof e.y?(s.Logger.debug("Toolbar position retrieved",e),e):null}catch(e){return s.Logger.warn("Failed to retrieve toolbar position:",e),null}}static async savePreferences(e){try{await chrome.storage.local.set({[r.Constants.STORAGE_KEYS.USER_PREFERENCES]:e}),s.Logger.debug("User preferences saved")}catch(e){throw s.Logger.error("Failed to save user preferences:",e),e}}static async getPreferences(){try{return(await chrome.storage.local.get([r.Constants.STORAGE_KEYS.USER_PREFERENCES]))[r.Constants.STORAGE_KEYS.USER_PREFERENCES]||{}}catch(e){return s.Logger.error("Failed to retrieve user preferences:",e),{}}}static async exportChatHistory(){const e=await this.getChatHistory(),t=((new Date).toISOString(),e.map(e=>`[${new Date(e.timestamp).toLocaleString()}] ${e.role.toUpperCase()}: ${e.content}`).join("\n\n"));return`Netherite Chat History Export\nExported: ${(new Date).toLocaleString()}\n\n${"=".repeat(50)}\n\n`+t}static async getStorageStats(){try{const e=await chrome.storage.local.get(null),t=new TextEncoder;let o=0,s=0;return e[r.Constants.STORAGE_KEYS.CURRENT_DOCUMENT]&&(o=t.encode(JSON.stringify(e[r.Constants.STORAGE_KEYS.CURRENT_DOCUMENT])).length),e[r.Constants.STORAGE_KEYS.CHAT_HISTORY]&&(s=t.encode(JSON.stringify(e[r.Constants.STORAGE_KEYS.CHAT_HISTORY])).length),{documentsSize:o,chatHistorySize:s,totalSize:o+s}}catch(e){return s.Logger.error("Failed to get storage stats:",e),{documentsSize:0,chatHistorySize:0,totalSize:0}}}}},628:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;class o{static info(e,...t){(this.isDevelopment||this.shouldLog("info"))&&console.info(`${this.PREFIX} â„¹ï¸`,e,...t)}static warn(e,...t){(this.isDevelopment||this.shouldLog("warn"))&&console.warn(`${this.PREFIX} âš ï¸`,e,...t)}static error(e,...t){console.error(`${this.PREFIX} âŒ`,e,...t)}static debug(e,...t){this.isDevelopment&&console.debug(`${this.PREFIX} ðŸ›`,e,...t)}static success(e,...t){(this.isDevelopment||this.shouldLog("info"))&&console.log(`${this.PREFIX} âœ…`,e,...t)}static trace(e,t){if(this.isDevelopment){const o=t?` (${t}ms)`:"";console.log(`${this.PREFIX} ðŸ“Š ${e}${o}`)}}static aiSession(e,t){this.isDevelopment&&console.log(`${this.PREFIX} ${{create:"ðŸš€",prompt:"ðŸ’­",destroy:"ðŸ—‘ï¸"}[e]} AI Session ${e}`,t||"")}static ui(e,t,o){this.isDevelopment&&console.log(`${this.PREFIX} ðŸŽ¨ UI [${t}] ${e}`,o||"")}static chromeAPI(e,t,o){this.isDevelopment&&console.log(`${this.PREFIX} ðŸ”Œ Chrome.${e} ${t}`,o||"")}static shouldLog(e){return"warn"===e}static startTimer(e){const t=performance.now();return()=>{const o=Math.round(performance.now()-t);this.trace(e,o)}}static field(e,t,o=!0){const r=o?"âœ…":"âŒ";this.isDevelopment&&console.log(`${this.PREFIX} ðŸ“ Field ${e}: ${t} ${r}`)}}t.Logger=o,o.PREFIX="[Netherite]",o.isDevelopment=!0}},t={};function o(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}(()=>{const e=o(167),t=o(628);new class{constructor(){this.fileInput=null,this.uploadArea=null,this.currentDocument=null,this.statusElement=null,this.initializePopup()}async initializePopup(){try{t.Logger.info("Initializing Netherite popup"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.setupUI()}):this.setupUI()}catch(e){t.Logger.error("Failed to initialize popup:",e)}}async setupUI(){try{this.fileInput=document.getElementById("fileInput"),this.uploadArea=document.getElementById("uploadArea"),this.currentDocument=document.getElementById("currentDocument"),this.statusElement=document.getElementById("ai-status"),this.setupEventListeners(),await this.updateAIStatus(),await this.loadCurrentDocument(),t.Logger.success("Popup UI initialized")}catch(e){t.Logger.error("Failed to setup popup UI:",e)}}setupEventListeners(){this.uploadArea?.addEventListener("click",()=>{this.fileInput?.click()}),this.fileInput?.addEventListener("change",e=>{this.handleFileUpload(e)}),this.uploadArea?.addEventListener("dragover",e=>{e.preventDefault(),this.uploadArea?.classList.add("drag-over")}),this.uploadArea?.addEventListener("dragleave",()=>{this.uploadArea?.classList.remove("drag-over")}),this.uploadArea?.addEventListener("drop",e=>{e.preventDefault(),this.uploadArea?.classList.remove("drag-over");const t=e.dataTransfer?.files;t&&t.length>0&&this.processFile(t[0])});const e=document.getElementById("removeDoc");e?.addEventListener("click",()=>{this.removeCurrentDocument()}),t.Logger.debug("Popup event listeners set up")}async handleFileUpload(e){const t=e.target.files;t&&t.length>0&&await this.processFile(t[0])}async processFile(o){try{if(t.Logger.info("Processing uploaded file:",o.name),!this.isValidFileType(o))return void this.showError("Unsupported file type. Please upload .txt, .pdf, .doc, or .docx files.");if(o.size>10485760)return void this.showError("File too large. Please upload files smaller than 10MB.");this.showUploadProgress(!0);const r=await this.readFileContent(o);if(r.length>5e4)return this.showError("Document too long. Please use documents with less than 50,000 characters."),void this.showUploadProgress(!1);const s={name:o.name,content:r,uploadDate:Date.now(),size:r.length};await e.StorageManager.saveDocument(s),this.displayCurrentDocument(s),this.showUploadProgress(!1),t.Logger.success("Document uploaded successfully:",o.name)}catch(e){t.Logger.error("Error processing file:",e),this.showError("Failed to upload document. Please try again."),this.showUploadProgress(!1)}}isValidFileType(e){return["text/plain","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)||[".txt",".pdf",".doc",".docx"].some(t=>e.name.toLowerCase().endsWith(t))}async readFileContent(e){return new Promise((t,o)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e)},r.onerror=()=>{o(new Error("Failed to read file"))},"text/plain"===e.type||e.name.toLowerCase().endsWith(".txt")?r.readAsText(e):o(new Error("Currently only .txt files are supported. PDF and Word support coming soon!"))})}async loadCurrentDocument(){try{const t=await e.StorageManager.getCurrentDocument();t?this.displayCurrentDocument(t):this.hideCurrentDocument()}catch(e){t.Logger.error("Failed to load current document:",e)}}displayCurrentDocument(e){const o=document.getElementById("docName");o&&(o.textContent=e.name),this.currentDocument&&(this.currentDocument.style.display="block"),this.uploadArea&&(this.uploadArea.style.display="none"),t.Logger.ui("Current document displayed","Popup")}hideCurrentDocument(){this.currentDocument&&(this.currentDocument.style.display="none"),this.uploadArea&&(this.uploadArea.style.display="block")}async removeCurrentDocument(){try{await e.StorageManager.removeDocument(),this.hideCurrentDocument(),this.fileInput&&(this.fileInput.value=""),t.Logger.success("Document removed")}catch(e){t.Logger.error("Failed to remove document:",e),this.showError("Failed to remove document. Please try again.")}}async updateAIStatus(){try{const e=await chrome.tabs.query({active:!0,currentWindow:!0});if(e[0]?.id){const t=await chrome.tabs.sendMessage(e[0].id,{type:"check-ai-status"});this.displayAIStatus(t?.aiAvailable||!1)}else this.displayAIStatus(!1,"No active tab")}catch(e){t.Logger.warn("Could not check AI status:",e),this.displayAIStatus(!1,"Unable to check")}}displayAIStatus(e,t){const o=document.getElementById("status-text"),r=this.statusElement;o&&(o.textContent=e?"AI Available (Gemini Nano Ready)":t||"AI Not Available - Check Chrome flags"),r&&(r.className=e?"status-indicator available":"status-indicator unavailable")}showUploadProgress(e){const t=this.uploadArea;t&&(e?(t.classList.add("uploading"),t.innerHTML='<div class="upload-spinner"></div><p>Uploading document...</p>'):(t.classList.remove("uploading"),t.innerHTML='\n                    <div class="upload-icon">ðŸ“„</div>\n                    <p>Drop files here or click to browse</p>\n                '))}showError(e){const o=document.createElement("div");o.className="error-notification",o.textContent=e,o.style.cssText="\n            position: fixed;\n            top: 10px;\n            left: 10px;\n            right: 10px;\n            background: #ef4444;\n            color: white;\n            padding: 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            z-index: 1000;\n        ",document.body.appendChild(o),setTimeout(()=>{o.parentNode&&document.body.removeChild(o)},5e3),t.Logger.error("Popup error shown to user:",e)}}})()})();